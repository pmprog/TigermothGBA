
#include "stages.h"
#include "gba.h"
#include "maths.h"
#include "tilefaces_bin.h"
#include "vars.h"

#define MENU_DELAY_TIME     2

const u8 menu_tilemap[] = {
    1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
    1,1,1,1,1,1,1,1,1,4,39,12,31,3,2,2,4,15,11,16,3,1,1,1,1,1,1,1,1,1,
    1,1,1,1,1,1,1,4,1,1,1,1,1,2,1,15,5,1,1,1,1,1,3,1,1,1,1,1,1,1,
    1,1,1,1,1,1,1,1,1,1,2,7,3,1,2,6,1,4,8,5,1,1,1,1,1,1,1,1,1,1,
    1,1,1,1,1,1,1,1,3,1,1,1,1,4,6,19,3,1,1,1,1,4,1,1,1,1,1,1,1,1,
    1,1,1,1,1,1,1,2,1,3,1,1,4,4,4,3,3,3,1,1,4,1,5,1,1,1,1,1,1,1,
    1,1,1,1,1,1,1,1,15,5,1,1,1,1,2,5,1,5,1,1,2,32,1,1,1,1,1,1,1,1,
    1,1,1,1,1,1,1,1,1,1,1,1,1,41,42,41,42,1,1,1,1,1,1,1,1,1,1,1,1,1,
    1,4,3,4,3,4,45,3,1,1,1,1,1,44,43,44,43,1,5,1,1,1,4,45,3,4,3,4,3,1,
    1,1,5,2,5,6,18,6,1,1,1,1,2,5,3,5,5,5,1,1,1,1,6,18,6,2,5,2,5,1,
    1,1,1,1,1,2,6,5,1,1,1,1,1,1,5,1,5,1,1,1,1,1,2,6,5,1,1,1,1,1,
    1,1,1,1,1,1,5,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,5,1,1,1,1,1,1,
    2,3,12,13,32,6,5,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,3,11,6,31,14,5,1,
    1,6,1,1,1,1,1,1,1,2,6,5,6,12,3,1,4,1,1,4,1,1,1,1,1,6,1,1,1,4,
    1,20,1,4,1,4,4,6,1,6,1,1,17,1,21,1,6,3,4,19,1,4,6,3,1,19,1,3,1,18,
    1,46,1,1,1,6,1,17,1,6,11,1,17,4,5,1,6,2,5,46,1,21,1,18,1,6,1,6,1,20,
    1,6,1,6,1,2,1,46,1,19,1,1,6,1,2,1,20,1,1,6,1,6,1,45,1,6,1,46,2,6,
    1,2,1,2,1,2,11,3,1,31,6,5,2,1,21,1,6,1,1,5,1,2,9,5,1,5,1,6,1,6,
    1,1,1,1,1,1,1,19,1,1,1,1,1,1,5,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,
    1,1,1,1,1,2,14,5,1,1,1,1,1,1,1,1,1,33,34,35,36,36,1,38,1,1,1,1,1,1
};

const u8 menu_colourmap[] = {
    0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,0,4,0,0,5,5,2,5,6,3,2,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,4,5,0,0,0,0,0,5,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,1,3,2,0,4,5,0,1,3,2,0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,4,0,0,0,0,4,5,6,6,0,0,0,0,4,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,4,0,0,4,4,1,2,5,6,0,0,4,0,5,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,5,0,0,0,1,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,2,3,0,0,0,0,0,0,0,0,0,0,0,0,0,
    0,0,1,1,2,1,2,2,0,0,0,0,0,0,1,0,1,0,1,0,0,0,1,2,2,1,2,1,2,0,
    0,0,0,0,1,0,3,2,0,0,0,0,0,1,2,2,1,0,0,0,0,0,0,3,1,0,1,0,1,0,
    0,0,0,0,0,0,2,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,1,0,0,0,0,0,
    0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,
    0,0,1,1,2,2,2,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,5,6,5,2,0,
    0,0,0,0,0,0,0,0,0,1,2,2,0,1,1,0,2,0,0,2,0,0,0,0,0,2,0,0,0,2,
    0,5,0,4,0,1,1,2,0,0,0,0,5,0,2,0,5,6,1,2,0,1,0,2,0,1,0,1,0,2,
    0,6,0,0,0,0,0,1,0,0,1,0,4,1,2,0,5,5,4,0,0,5,0,6,0,1,0,0,0,6,
    0,4,0,5,0,4,0,6,0,0,0,0,4,0,5,0,1,0,0,0,0,4,0,5,0,0,0,4,4,5,
    0,4,0,1,0,4,4,5,0,4,5,4,4,0,6,0,0,0,0,1,0,0,2,1,0,0,0,0,0,0,
    0,0,0,0,0,0,0,4,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,1,4,0,0,0,0,0,0,0,0,0,7,7,7,7,7,0,7,0,0,0,0,0,0
};

const FullscreenInfo menu_fsinfo = { tilefaces_bin, 8, 384, menu_tilemap, menu_colourmap, menu_palettes };

void menu_update()
{
    if( stage_initialised == 0 )
    {
       	mmStart( MOD_TIGERMOTH_TITLE, MM_PLAY_LOOP );
        frame_delay = MENU_DELAY_TIME;
        stage_initialised = 1;
    }

    if((keysHeld() & (KEY_A | KEY_START)) != 0)
    {
        mmStop();
        SetStage(setuparena_update);
        raninit(frame_time);
        return;
    }

    frame_delay--;
    if(frame_delay >= 0) 
    {
        return;
    }

    BlitFullscreen(&menu_fsinfo, FULLSCREEN_COLUMNS_COLUMNS);

    frame_time++;
    frame_time &= 0x00FF;
    frame_delay = MENU_DELAY_TIME;
}
